Fix Zalo Admin Display Name - Hướng Dẫn & Backup Code
Tóm tắt vấn đề
Khi đăng nhập Zalo QR, display_name trong NocoDB hiển thị là ownId hoặc số điện thoại thay vì tên Zalo thật.

Giải pháp
1. VPS - Thêm route /api/accounts/:ownId
File: 
zalo_server/routes/api.js
 (line ~215)

// Lấy chi tiết một tài khoản với profile.displayName - optional API key
router.get('/accounts/:ownId', optionalApiKey(), rateLimiters.lenient, getAccountDetails);
Lý do: Route này gọi 
getAccountDetails
 function để fetch profile từ Zalo API với displayName đúng.

2. VPS - Function 
getAccountDetails
File: 
zalo_server/api/zalo/zalo.js
 (line ~75)

export async function getAccountDetails(req, res) {
    try {
        const { ownId } = req.params;
        const account = zaloAccounts.find(acc => acc.ownId === ownId);
        if (!account) {
            return res.status(404).json({ error: 'Không tìm thấy tài khoản' });
        }
        // Lấy thông tin profile từ API
        const accountInfo = await account.api.fetchAccountInfo();
        res.json({
            success: true,
            data: {
                ownId: account.ownId,
                phoneNumber: account.phoneNumber,
                proxy: account.proxy || 'Không có proxy',
                profile: accountInfo?.profile || {},
                isOnline: account.api ? true : false
            }
        });
    } catch (error) {
        res.status(500).json({ success: false, error: error.message });
    }
}
Key point: Gọi account.api.fetchAccountInfo() để lấy profile.displayName từ Zalo SDK.

3. Frontend - Gọi 
getAccountDetails
 API
File: 
src/pages/SuperAdmin/ZaloAdminSettings.tsx
 (function 
saveAdminAccount
)

const saveAdminAccount = async (accountData: any) => {
    try {
        const headers = await getNocoDBHeaders();
        // Get account details using accountDetails API (returns profile.displayName)
        console.log('[Zalo Admin] Fetching account details for:', accountData.ownId);
        const detailsRes = await zaloApiClient.getAccountDetails(accountData.ownId);
        console.log('[Zalo Admin] Account details response:', detailsRes);
        let accountInfo: any = {};
        let profileData: any = {};
        if (detailsRes.success && detailsRes.data) {
            accountInfo = detailsRes.data;
            profileData = accountInfo.profile || {};
        }
        // Get displayName from profile (this is the correct Zalo name)
        const displayName = profileData.displayName
            || profileData.name
            || accountInfo.displayName
            || accountInfo.zaloName
            || accountData.ownId;
        const payload = {
            own_id: accountData.ownId,
            display_name: displayName,
            phone_number: accountInfo.phoneNumber || '',
            avatar_url: profileData.avatar || accountInfo.avatar || '',
            is_active: true,
        };
        // ... save to NocoDB
    }
}
4. Frontend - API Client
File: 
src/services/zaloApiClient.ts
 (line ~100)

// Get specific account details with profile info
// GET /api/accounts/:ownId
getAccountDetails: async (ownId: string) => {
    return await invokeProxy(`/api/accounts/${ownId}`, 'GET');
},
Luồng hoạt động
1. User quét QR → VPS gửi "login_success" qua WebSocket
2. Frontend gọi /api/accounts → lấy danh sách (chưa có displayName đúng)
3. Frontend gọi /api/accounts/:ownId → VPS gọi Zalo SDK fetchAccountInfo()
4. VPS trả về profile.displayName = "Nguyễn Anh Tuấn Office"
5. Frontend lưu vào NocoDB với display_name đúng
Deploy lên VPS
# 1. Upload files
scp zalo_server/routes/api.js root@103.118.28.213:/root/zalo-backend/src/routes/api.js
scp zalo_server/api/zalo/zalo.js root@103.118.28.213:/root/zalo-backend/src/api/zalo/zalo.js
# 2. Rebuild Docker
ssh root@103.118.28.213 "cd /root/zalo-backend && docker compose build --no-cache && docker compose up -d"
Kết quả mong đợi
Console log sau khi login thành công:

[Zalo Admin] Profile data: {displayName: 'Nguyễn Anh Tuấn Office', avatar: 'https://...'}
[Zalo Admin] Payload to save: {display_name: 'Nguyễn Anh Tuấn Office', ...}
NocoDB zalo_accounts_admin table:

display_name: "Nguyễn Anh Tuấn Office" ✅ (không phải ownId hoặc SĐT)